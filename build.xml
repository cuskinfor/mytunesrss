<?xml version="1.0" encoding="UTF-8"?>

<project name="MyTunesRSS Runtime" basedir="." default="zip.distribution">

    <import file="../CodewaveAnt/etc/svn-macros.xml"/>
    <taskdef name="codewave.moduleinfo" classname="de.codewave.ant.task.moduleinfo.ModuleInfoTask"/>

    <target name="idea.after-compile" description="target to execute after compilation in idea">
        <antcall target="generate.moduleinfo"/>
        <antcall target="copy.tomcat-config"/>
    </target>

    <target name="generate.moduleinfo" description="generate the model information files">
        <svn.propget property="version" path="." name="codewave:version"/>
        <mkdir dir="Runtime/classes/META-INF"/>
        <codewave.moduleinfo destfile="Runtime/classes/META-INF/codewave-version.xml" name="MyTunesRSS" version="${version}"/>
    </target>

    <target name="copy.tomcat-config" description="copy the tomcat embedded configuration to the distribution">
        <copy todir="distribution" overwrite="true">
            <fileset dir="etc">
                <include name="conf/**"/>
            </fileset>
        </copy>
    </target>

    <target name="zip.distribution" description="generate a zip archive of the whole distribution">
        <svn.propget property="version" path="." name="codewave:version"/>
        <zip destfile="distribution/MyTunesRSS-${version}.zip" basedir="distribution">
            <include name="conf/**"/>
            <include name="lib/**"/>
            <include name="tomcat/**"/>
            <include name="webapps/**"/>
            <include name="MyTunesRSS.jar"/>
            <include name="*.bat"/>
            <include name="*.sh"/>
            <include name="*.pdf"/>
            <fileset dir="etc">
                <include name="*.app"/>
                <include name="*.bat"/>
                <include name="*.sh"/>
                <include name="*.pdf"/>
            </fileset>
        </zip>
    </target>

</project>