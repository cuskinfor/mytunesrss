<?xml version="1.0" encoding="UTF-8"?>

<project name="MyTunesRSS Runtime" basedir="." default="zip.distribution">

    <import file="../CodewaveAnt/etc/svn-macros.xml"/>
    <import file="../CodewaveAnt/etc/moduleinfo-macros.xml"/>

    <target name="idea.after-compile" description="target to execute after compilation in idea">
        <antcall target="generate.moduleinfo"/>
        <antcall target="copy.tomcat-config"/>
    </target>

    <target name="generate.moduleinfo" description="generate the model information files">
        <svn.propget property="version" path="." name="codewave:version"/>
        <moduleinfo.jar destfile="distribution/MyTunesRSS.jar" name="MyTunesRSS" version="${version}"/>
    </target>

    <target name="copy.tomcat-config" description="copy the tomcat embedded configuration to the distribution">
        <copy todir="distribution" overwrite="true">
            <fileset dir="etc">
                <include name="conf/**"/>
            </fileset>
        </copy>
    </target>

    <target name="zip.distribution" description="generate a zip archive of the whole distribution">
        <svn.propget property="version" path="." name="codewave:version"/>
        <zip destfile="distribution/MyTunesRSS-${version}.zip">
            <fileset dir="distribution">
                <include name="conf/**"/>
                <include name="lib/**"/>
                <include name="tomcat/**"/>
                <include name="webapps/**"/>
                <include name="MyTunesRSS.jar"/>
            </fileset>
            <fileset dir="etc/documentation">
                <include name="**"/>
            </fileset>
        </zip>
        <zip destfile="distribution/MyTunesRSS_Windows-${version}.zip">
            <zipfileset dir="distribution" prefix="data">
                <include name="conf/**"/>
                <include name="lib/**"/>
                <include name="tomcat/**"/>
                <include name="webapps/**"/>
                <include name="MyTunesRSS.jar"/>
            </zipfileset>
            <zipfileset dir="etc" prefix="data">
                <include name="java.properties"/>
            </zipfileset>
            <fileset dir="etc">
                <include name="*.exe"/>
            </fileset>
            <fileset dir="etc/documentation">
                <include name="**"/>
            </fileset>
        </zip>
        <zip destfile="distribution/MyTunesRSS_MacOSX-${version}.zip">
            <fileset dir="etc/MacOS-Bundle">
                <exclude name="**/JavaApplicationStub*"/>
            </fileset>
            <zipfileset dir="etc/MacOS-Bundle" filemode="755">
                <include name="**/JavaApplicationStub*"/>
            </zipfileset>
            <zipfileset dir="distribution" prefix="MyTunesRSS.app/Contents/Resources/Java">
                <include name="conf/**"/>
                <include name="lib/**"/>
                <include name="tomcat/**"/>
                <include name="webapps/**"/>
                <include name="MyTunesRSS.jar"/>
            </zipfileset>
            <fileset dir="etc/documentation">
                <include name="**"/>
            </fileset>
        </zip>
    </target>

</project>