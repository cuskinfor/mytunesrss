<?xml version="1.0" encoding="UTF-8"?>

<statements>

    <statement name="findAlbumImage">
        <sql>
            SELECT data AS data FROM image i, track t WHERE t.album = :album AND i.hash = t.image_hash AND i.size = :size LIMIT 1 OFFSET 0
        </sql>
    </statement>

    <statement name="nextPlaylistId">
        <sql>SELECT nextval('playlist_id_sequence') AS id FROM system_information</sql>
    </statement>

    <statement name="createSearchTempTables">
        <sql>
            CREATE TEMPORARY TABLE temp_lucene_tracks (
                pos SERIAL,
                track_id VARCHAR(100),
                UNIQUE(track_id)
            ) ON COMMIT DROP
        </sql>
    </statement>

    <!-- reusable sql fragments -->

    <fragment name="selectLimitedTracks">SELECT {trackColumns}</fragment>

    <fragment name="findLastUpdatedTracksOrderClause">ORDER BY ts_updated DESC LIMIT :maxCount OFFSET 0</fragment>

    <fragment name="findMostPlayedTracksOrderClause">ORDER BY playcount DESC LIMIT :maxCount OFFSET 0</fragment>

    <fragment name="findRecentlyPlayedTracksOrderClause">ORDER BY ts_played DESC LIMIT :maxCount OFFSET 0</fragment>

    <fragment name="smartPlaylistOrderAndLimitHead">
        SELECT
    </fragment>

    <fragment name="smartPlaylistOrderAndLimit">
        <![CDATA[
            <random>ORDER BY random()</random>
            <limit>LIMIT :maxCount OFFSET 0</limit>
        ]]>
    </fragment>

</statements>
