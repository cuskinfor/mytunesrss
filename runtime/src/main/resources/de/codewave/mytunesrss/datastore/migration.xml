<?xml version="1.0" encoding="UTF-8"?>

<statements>

    <statement name="getVersion">
        <sql>SELECT version AS version FROM system_information</sql>
    </statement>

    <statement name="migrate30to31eap1">
        <sql>DROP TABLE IF EXISTS pager</sql>
        <sql>ALTER TABLE link_track_playlist ALTER COLUMN index RENAME TO idx</sql>
        <sql>CREATE INDEX idx_link_track_playlist_index ON link_track_playlist (idx)</sql>
    </statement>

    <statement name="migrate31eap131eap4">
        <sql>ALTER TABLE track ALTER COLUMN id VARCHAR(100) NOT NULL</sql>
        <sql>ALTER TABLE link_track_playlist ALTER COLUMN track_id VARCHAR(100) NOT NULL</sql>
    </statement>

    <statement name="migrate31eap4to31eap6">
        <sql>UPDATE system_information SET lastupdate = 0</sql>
        <sql>
            {create_table_prefix} image (
                track_id VARCHAR(100) NOT NULL,
                size INTEGER NOT NULL,
                data {image_datatype} NOT NULL,
                UNIQUE(track_id, size))
        </sql>
    </statement>

    <statement name="migrate31eap6to31eap9">
        <sql>ALTER TABLE playlist ALTER COLUMN id VARCHAR(100)</sql>
        <sql>ALTER TABLE link_track_playlist ALTER COLUMN playlist_id VARCHAR(100)</sql>
    </statement>

    <statement name="migrate31eap9to31eap11">
        <sql>ALTER TABLE track ADD COLUMN mp4codec VARCHAR(4)</sql>
        <sql>ALTER TABLE track ADD COLUMN ts_played NUMERIC(19)</sql>
        <sql>ALTER TABLE track ADD COLUMN ts_updated NUMERIC(19)</sql>
        <sql>ALTER TABLE track ADD COLUMN playcount NUMERIC(19)</sql>
        <sql>DELETE FROM track WHERE LOWER(file) LIKE '%mp4'</sql>
        <sql>DELETE FROM track WHERE LOWER(file) LIKE '%m4a'</sql>
        <sql>DELETE FROM track WHERE LOWER(file) LIKE '%m4p'</sql>
        <sql>DELETE FROM track WHERE LOWER(file) LIKE '%m4v'</sql>
    </statement>

    <statement name="migrate31eap11to31eap12">
        <sql>ALTER TABLE playlist ADD COLUMN hidden BOOLEAN</sql>
        <sql>ALTER TABLE playlist ADD COLUMN user_private BOOLEAN</sql>
        <sql>ALTER TABLE playlist ADD COLUMN user_owner VARCHAR(256)</sql>
    </statement>

    <statement name="migrate31eap12to31eap16">
        <sql>ALTER TABLE system_information ADD COLUMN track_count INTEGER</sql>
        <sql>ALTER TABLE system_information ADD COLUMN album_count INTEGER</sql>
        <sql>ALTER TABLE system_information ADD COLUMN artist_count INTEGER</sql>
        <sql>ALTER TABLE system_information ADD COLUMN genre_count INTEGER</sql>
        <sql>ALTER TABLE track ADD COLUMN last_image_update NUMERIC(19)</sql>
        <sql>ALTER TABLE track ADD COLUMN last_seen NUMERIC(19)</sql>
    </statement>

    <statement name="migrate31eap16to31eap17">
        <sql>ALTER TABLE track DROP COLUMN last_seen</sql>
    </statement>

    <statement name="migrate31eap17to31eap20">
        <sql>ALTER TABLE track ADD COLUMN comment VARCHAR(2048)</sql>
    </statement>

    <statement name="migrate_3.2_eap_1">
        <sql>ALTER TABLE track ADD COLUMN pos_number INTEGER</sql>
        <sql>ALTER TABLE track ADD COLUMN pos_size INTEGER</sql>
    </statement>

    <statement name="migrate_3.2_eap_10">
        <sql>ALTER TABLE track ADD COLUMN image_hash CHAR(24)</sql>
        <sql>UPDATE track SET last_image_update = 0</sql>
        <sql>DROP TABLE image</sql>
        <sql>{create_table_prefix} image ( hash CHAR(24) NOT NULL, size INTEGER NOT NULL, data {image_datatype} NOT NULL, UNIQUE (hash, size) )</sql>
    </statement>

    <statement name="migrate_3.2_eap_12">
        <sql>CREATE INDEX idx_track_imagehash ON track (image_hash)</sql>
    </statement>

    <statement name="migrate_3.2_eap_13">
        <sql>ALTER TABLE playlist ADD COLUMN ts_create NUMERIC(19)</sql>
    </statement>

    <statement name="migrate_3.2_eap_16_part1">
        <sql>ALTER TABLE track ADD COLUMN original_artist VARCHAR(255)</sql>
    </statement>

    <statement name="migrate_3.6_eap_1">
        <sql>ALTER TABLE playlist ADD COLUMN container_id VARCHAR(100)</sql>
    </statement>

    <statement name="migrate_3.6_eap_12">
        <sql>
            {create_table_prefix} statistics (
                ts_create NUMERIC(19) NOT NULL,
                data {statistics_datatype} NOT NULL
            )
        </sql>
        <sql>CREATE INDEX idx_statistics_creation ON statistics (ts_create)</sql>
    </statement>

    <statement name="migrate_3.7_eap_1">
        <sql>
            {create_table_prefix} smart_info (
                playlist_id VARCHAR(100) NOT NULL,
                album_pattern VARCHAR(100),
                artist_pattern VARCHAR(100),
                genre_pattern VARCHAR(100),
                title_pattern VARCHAR(100),
                file_pattern VARCHAR(100),
                time_min INTEGER,
                time_max INTEGER,
                video BOOLEAN,
                protected BOOLEAN,
                UNIQUE (playlist_id)
            )
        </sql>
    </statement>

</statements>