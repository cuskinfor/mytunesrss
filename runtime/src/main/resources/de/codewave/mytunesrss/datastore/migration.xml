<?xml version="1.0" encoding="UTF-8"?>

<statements>
    <statement name="getVersion">
        <sql>SELECT version AS version FROM system_information</sql>
    </statement>

    <statement name="migrate30to31eap1">
        <sql>DROP TABLE pager</sql>
    </statement>

    <statement name="migrate31eap131eap4">
        <sql>ALTER TABLE track ALTER COLUMN id VARCHAR(100) NOT NULL</sql>
        <sql>ALTER TABLE link_track_playlist ALTER COLUMN track_id VARCHAR(100) NOT NULL</sql>
    </statement>

    <statement name="migrate31eap4to31eap6">
        <sql>UPDATE system_information SET lastupdate = 0</sql>
        <sql>
            {create_table_prefix} image (
                track_id VARCHAR(100) NOT NULL,
                size INTEGER NOT NULL,
                data {image_datatype} NOT NULL,
                UNIQUE(track_id, size))
        </sql>
    </statement>

    <statement name="migrate31eap6to31eap9">
        <sql>ALTER TABLE playlist ALTER COLUMN id VARCHAR(100)</sql>
        <sql>ALTER TABLE link_track_playlist ALTER COLUMN playlist_id VARCHAR(100)</sql>
    </statement>

    <statement name="migrate31eap9to31eap11">
        <sql>ALTER TABLE track ADD COLUMN mp4codec VARCHAR(4)</sql>
        <sql>ALTER TABLE track ADD COLUMN ts_played NUMERIC(19)</sql>
        <sql>ALTER TABLE track ADD COLUMN ts_updated NUMERIC(19)</sql>
        <sql>ALTER TABLE track ADD COLUMN playcount NUMERIC(19)</sql>
        <sql>DELETE FROM track WHERE LOWER(file) LIKE '%mp4'</sql>
        <sql>DELETE FROM track WHERE LOWER(file) LIKE '%m4a'</sql>
        <sql>DELETE FROM track WHERE LOWER(file) LIKE '%m4p'</sql>
        <sql>DELETE FROM track WHERE LOWER(file) LIKE '%m4v'</sql>
    </statement>

    <statement name="migrate31eap11to31eap12">
        <sql>ALTER TABLE playlist ADD COLUMN hidden BOOLEAN</sql>
        <sql>ALTER TABLE playlist ADD COLUMN user_private BOOLEAN</sql>
        <sql>ALTER TABLE playlist ADD COLUMN user_owner VARCHAR(256)</sql>
    </statement>

    <statement name="migrate31eap12to31eap16">
        <sql>ALTER TABLE system_information ADD COLUMN track_count INTEGER</sql>
        <sql>ALTER TABLE system_information ADD COLUMN album_count INTEGER</sql>
        <sql>ALTER TABLE system_information ADD COLUMN artist_count INTEGER</sql>
        <sql>ALTER TABLE system_information ADD COLUMN genre_count INTEGER</sql>
        <sql>ALTER TABLE track ADD COLUMN last_image_update NUMERIC(19)</sql>
        <sql>ALTER TABLE track ADD COLUMN last_seen NUMERIC(19)</sql>
    </statement>

    <statement name="migrate31eap16to31eap17">
        <sql>ALTER TABLE track DROP COLUMN last_seen</sql>
    </statement>

</statements>