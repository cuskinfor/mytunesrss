<html>

<head>

    <title>MyTunesRSS Jukebox</title>

    <meta name="viewport" content="width=device-width">

    <style type="text/css">
        html, body {
            margin: 0;
            padding: 0;
        }

        #jukeboxdiv {
            position: absolute;
            top: 0;
            left: 0;
        }

        div.even {
            background-color: #ffffff;
        }

        div.odd {
            background-color: #f4f7fb;
        }

        div.current {
            color: #ff0000;
            font-weight: bold;
        }

        #playlist {
            margin-top: 30px;
        }

        div.playlistitem {
            padding-top: 10px;
            padding-bottom: 10px;
            padding-left: 5px;
            padding-right: 5px;
        }
    </style>

    <script type="text/javascript" src="../../js/jquery.js"></script>
    <script type="text/javascript">

        var playlist;
        var currentTrack;

        $(document).ready(function() {
            new $.ajax({
                url : "{PLAYLIST_URL}",
                type : "GET",
                processData : false,
                success : function(data) {
                    init(data);
                }
            });
        });

        function scrollPlayer() {
            $("#jukeboxdiv").css("top", ($(window).scrollTop() + 10) + "px");
            $(window)[0].setTimeout(scrollPlayer, 1000);
        }

        function removeAudioAndVideo() {
            $("audio,video").remove();
        }

        function setPlaylistMarker() {
            $("#playlist div").each(function(eachIndex) {
                if (eachIndex == currentTrack) {
                    $(this).addClass("current");
                } else {
                    $(this).removeClass("current");
                }
            });
        }

        function playCurrentTrack() {
            if (currentTrack < playlist.length) {
                setPlaylistMarker();
                if (playlist[currentTrack].mediaType === "Video") {
                    removeAudioAndVideo();
                    $("#jukeboxdiv").append("<video controls=\"controls\" width=\"1px\" height=\"1px\" onended=\"removeAudioAndVideo()\" src=\"" + playlist[currentTrack].location + "\"></video>");
                    $("video")[0].play();
                } else if (playlist[currentTrack].mediaType === "Audio" && $("audio").length === 0) {
                    removeAudioAndVideo();
                    $("#jukeboxdiv").append("<audio controls=\"controls\" ontimeupdate=\"updateTime()\" src=\"" + playlist[currentTrack].location + "\"></audio>");
                    $("audio")[0].play();
                } else if (playlist[currentTrack].mediaType === "Audio") {
                    $("audio").attr("src", playlist[currentTrack].location);
                    $("audio")[0].play();
                }
            } else {
                removeAudioAndVideo();
            }

        }

        function playTrack(track) {
            currentTrack = track;
            playCurrentTrack();
        }

        function updateTime() {
            var jukebox = $("audio");
            if (jukebox[0].duration - jukebox[0].currentTime < 1) {
                currentTrack++;
                while (currentTrack < playlist.length && playlist[currentTrack].mediaType === "Video") {
                    currentTrack++;
                }
                playCurrentTrack();
            }
        }

        function init(data) {
            playlist = data;
            for (var i = 0; i < data.length; i++) {
                $("#playlist").append("<div class=\"playlistitem " + (i % 2 == 0 ? "even" : "odd") + "\" onclick=\"playTrack(" + i + ")\">" + data[i].artist + " - " + data[i].name + "</div>");
            }
            scrollPlayer();
        }

    </script>

</head>

<body>

<div id="jukeboxdiv">
</div>

<div id="playlist">
</div>

</body>

</html>
